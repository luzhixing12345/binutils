<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    <link rel='stylesheet' href=../../../css/c.css /><link rel='stylesheet' href=../../../css/shell.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/luzhixing12345/binutils.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">readelf</a><ul><li><a href="#h2-1">ELF 文件标准历史</a></li></ul><ul><li><a href="#h2-2">ELF 文件格式</a><ul><li><a href="#h3-3">基本结构</a></li></ul><ul><li><a href="#h3-4">段表</a></li></ul><ul><li><a href="#h3-5">符号表和重定位表</a></li></ul><ul><li><a href="#h3-6">程序头(program header)</a></li></ul></li></ul><ul><li><a href="#h2-7">参考</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">readelf</h1><pre class="language-shell"><code><span class="BraceDepth-0 Token LPAREN">(</span><span class="Program Token ID">base</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token SPACE"> </span><span class="Token HOST_NAME">kamilu@LZX</span><span class="Token COLON">:</span><span class="Token DIR_PATH">~/binutils</span><span class="Token TAG">$</span><span class="Token SPACE"> </span><span class="Program Token PATH">./src/readelf</span><span class="Token SPACE"> </span><span class="Token OPTION">--help</span><span class="Token LF">
</span><span class="Program Token ID">Usage:</span><span class="Token SPACE"> </span><span class="Token ID">readelf</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token ID">OPTION</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token ID">...</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token ID">files</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token ID">...</span><span class="Token LF">
</span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">information</span><span class="Token SPACE"> </span><span class="Token ID">about</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Token ID">contents</span><span class="Token SPACE"> </span><span class="Token ID">of</span><span class="Token SPACE"> </span><span class="Token ID">ELF</span><span class="Token SPACE"> </span><span class="Token ID">format</span><span class="Token SPACE"> </span><span class="Token ID">files</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-H</span><span class="Token SPACE">   </span><span class="Token OPTION">--help</span><span class="Token SPACE">                </span><span class="Program Token ID">show</span><span class="Token SPACE"> </span><span class="Token ID">help</span><span class="Token SPACE"> </span><span class="Token ID">information</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-v</span><span class="Token SPACE">   </span><span class="Token OPTION">--version</span><span class="Token SPACE">             </span><span class="Program Token ID">show</span><span class="Token SPACE"> </span><span class="Token ID">version</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-h</span><span class="Token SPACE">   </span><span class="Token OPTION">--file-header</span><span class="Token SPACE">         </span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Token ID">ELF</span><span class="Token SPACE"> </span><span class="Token ID">file</span><span class="Token SPACE"> </span><span class="Token ID">header</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-S</span><span class="Token SPACE">   </span><span class="Token OPTION">--section-headers</span><span class="Token SPACE">     </span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Token ID">sections</span><span class="Token APOSTROPHE">&#x27;</span><span class="Token SPACE"> </span><span class="Token ID">header</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token OPTION">--sections</span><span class="Token SPACE">            </span><span class="Program Token ID">An</span><span class="Token SPACE"> </span><span class="Token ID">alias</span><span class="Token SPACE"> </span><span class="Keyword Token FOR">for</span><span class="Token SPACE"> </span><span class="Token OPTION">--section-headers</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-s</span><span class="Token SPACE">   </span><span class="Token OPTION">--syms</span><span class="Token SPACE">                </span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Token ID">symbol</span><span class="Token SPACE"> </span><span class="Token ID">table</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token OPTION">--symbols</span><span class="Token SPACE">             </span><span class="Program Token ID">An</span><span class="Token SPACE"> </span><span class="Token ID">alias</span><span class="Token SPACE"> </span><span class="Keyword Token FOR">for</span><span class="Token SPACE"> </span><span class="Token OPTION">--syms</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-r</span><span class="Token SPACE">   </span><span class="Token OPTION">--relocs</span><span class="Token SPACE">              </span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Function Token ID">relocations</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Keyword Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">present</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-l</span><span class="Token SPACE">   </span><span class="Token OPTION">--program-header</span><span class="Token SPACE">      </span><span class="Program Token ID">Display</span><span class="Token SPACE"> </span><span class="Token ID">the</span><span class="Token SPACE"> </span><span class="Token ID">program</span><span class="Token SPACE"> </span><span class="Token ID">headers</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token OPTION">--segments</span><span class="Token SPACE">            </span><span class="Program Token ID">An</span><span class="Token SPACE"> </span><span class="Token ID">alias</span><span class="Token SPACE"> </span><span class="Keyword Token FOR">for</span><span class="Token SPACE"> </span><span class="Token OPTION">--program-headers</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Token OPTION">-T</span><span class="Token SPACE">   </span><span class="Token OPTION">--silent-truncation</span><span class="Token SPACE">   </span><span class="Program Token ID">If</span><span class="Token SPACE"> </span><span class="Token ID">a</span><span class="Token SPACE"> </span><span class="Token ID">symbol</span><span class="Token SPACE"> </span><span class="Token ID">name</span><span class="Token SPACE"> </span><span class="Token ID">is</span><span class="Token SPACE"> </span><span class="Token ID">truncated</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Keyword Token DO">do</span><span class="Token SPACE"> </span><span class="Token ID">not</span><span class="Token SPACE"> </span><span class="Token ID">add</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token ID">...</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ID">suffix</span></code></pre><h2 id="h2-1">ELF 文件标准历史</h2><p>20世纪90年代, 一些厂商联合成立了一个委员会, 起草并发布了一个 ELF 文件格式标准供公开使用, 并希望所有人都可以遵循这项标准并从中获益. 1993 年委员会发布了 <a href="https://refspecs.linuxfoundation.org/elf/TIS1.1.pdf" target="_blank">ELF 文件标准</a>, 当时参与该委员会的有来自于编译器的厂商, 比如 Watcom(Watcom C/C++ 编译器) 和 Borland(Borland Turbo Pascal 编译器); 来自 CPU 的厂商比如 IBM 和 Intel; 来自操作系统的厂商比如IBM 和 Microsoft. 1995 年委员会发布了 <a href="https://refspecs.linuxfoundation.org/elf/elf.pdf" target="_blank">ELF1.2标准</a>, 自此委员会完成了自己的使命, 不久就解散了, 所以 ELF 文件格式标准的最新版本也是最后一个版本就是 1.2</p><blockquote><p><a href="https://refspecs.linuxfoundation.org" target="_blank">https://refspecs.linuxfoundation.org</a>/</p></blockquote><p>readelf 需要传入一个 ELF 文件名, 以下的内容基于 examples/SimpleSection.c, 会随 make 一同编译, 最后得到 SimpleSection.o</p><pre class="language-c"><code><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType INT">int</span><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType SPACE"> </span><span class="Identifier FunctionName DirectDeclaractor Token ID">printf</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator LPAREN">(</span><span class="QualifyType Keyword Token CONST">const</span><span class="QualifyType Keyword Token SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType CHAR">char</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Pointer Token Declarator POINTER">*</span><span class="Identifier DirectDeclaractor Token ID">format</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token VARARGS">...</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator RPAREN">)</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token LF">
</span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">global_init_var</span><span class="Identifier DirectDeclaractor Token SPACE"> </span><span class="InitDeclarator Token ASSIGN">=</span><span class="InitDeclarator Token SPACE"> </span><span class="PrimaryExpression Token Constant NUMBER">84</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">global_uninit_var</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token LF">
</span><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType VOID">void</span><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType SPACE"> </span><span class="Identifier FunctionName DirectDeclaractor Token ID">func1</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator LPAREN">(</span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">i</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator RPAREN">)</span><span class="DirectDeclaractor Token Declarator SPACE"> </span><span class="Function BraceDepth-0 Token CompoundStatement LCURLY_BRACE">{</span><span class="Function Token CompoundStatement LF">
</span><span class="Function Token CompoundStatement SPACE">    </span><span class="Identifier FunctionName Token PrimaryExpression ID">printf</span><span class="BraceDepth-1 Token LPAREN">(</span><span class="String Token STRING">&quot;</span><span class="String Format Token STRING">%d</span><span class="String Control Token STRING">\n</span><span class="String Token STRING">&quot;</span><span class="PPtoken Token COMMA">,</span><span class="Identifier Token ID">i</span><span class="BraceDepth-1 Token RPAREN">)</span><span class="ExpressionStatement Token SEMI">;</span><span class="ExpressionStatement Token LF">
</span><span class="Function BraceDepth-0 Token CompoundStatement RCURLY_BRACE">}</span><span class="Function Token CompoundStatement LF">
</span><span class="Function Token CompoundStatement LF">
</span><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType INT">int</span><span class="TypeSpecifier Keyword BaseType Token FunctionReturnType SPACE"> </span><span class="Identifier FunctionName DirectDeclaractor Token ID">main</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator LPAREN">(</span><span class="TypeSpecifier Keyword Token BaseType VOID">void</span><span class="BraceDepth-0 DirectDeclaractor Token Declarator RPAREN">)</span><span class="DirectDeclaractor Token Declarator SPACE"> </span><span class="Function BraceDepth-0 Token CompoundStatement LCURLY_BRACE">{</span><span class="Function Token CompoundStatement LF">
</span><span class="Function Token CompoundStatement SPACE">    </span><span class="Keyword Token StorageType STATIC">static</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">static_var</span><span class="Identifier DirectDeclaractor Token SPACE"> </span><span class="InitDeclarator Token ASSIGN">=</span><span class="InitDeclarator Token SPACE"> </span><span class="PrimaryExpression Token Constant NUMBER">85</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token SPACE">    </span><span class="Keyword Token StorageType STATIC">static</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">static_var2</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token SPACE">    </span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">a</span><span class="Identifier DirectDeclaractor Token SPACE"> </span><span class="InitDeclarator Token ASSIGN">=</span><span class="InitDeclarator Token SPACE"> </span><span class="PrimaryExpression Token Constant NUMBER">1</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token SPACE">    </span><span class="TypeSpecifier Keyword Token BaseType INT">int</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="Identifier DirectDeclaractor Token ID">b</span><span class="Declaration Token SEMI">;</span><span class="Declaration Token LF">
</span><span class="Declaration Token SPACE">    </span><span class="Identifier FunctionName Token PrimaryExpression ID">func1</span><span class="BraceDepth-1 Token LPAREN">(</span><span class="Identifier Token ID">static_var</span><span class="Identifier Token SPACE"> </span><span class="PPtoken Token PLUS">+</span><span class="PPtoken Token SPACE"> </span><span class="Identifier Token ID">static_var2</span><span class="Identifier Token SPACE"> </span><span class="PPtoken Token PLUS">+</span><span class="PPtoken Token SPACE"> </span><span class="Identifier Token ID">a</span><span class="Identifier Token SPACE"> </span><span class="PPtoken Token PLUS">+</span><span class="PPtoken Token SPACE"> </span><span class="Identifier Token ID">b</span><span class="BraceDepth-1 Token RPAREN">)</span><span class="ExpressionStatement Token SEMI">;</span><span class="ExpressionStatement Token LF">
</span><span class="Function BraceDepth-0 Token CompoundStatement RCURLY_BRACE">}</span></code></pre><h2 id="h2-2">ELF 文件格式</h2><h3 id="h3-3">基本结构</h3><p>ELF 文件的作用有两个,一是用于程序链接(为了生成程序);二是用于程序执行(为了运行程序). 从链接和运行的角度,可以将 ELF 文件的组成部分划分为 链接视图 和 运行试图 这两种格式, 如下所示.</p><p>ELF 目标文件格式的最前部是 ELF 文件头(ELF Header), 它包含了描述整个文件的基本属性. 接着是 ELF 文件各个段, 其中 ELF 文件中与段有关的重要结构就是<b>段表</b>(Section Header Table), 该表描述了 ELF 包含的所有段的信息, 比如每个段的段名,段长度,文件中的偏移量,读写权限和段的其他属性</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230819194148.png" alt="20230819194148"></p><p>其中右侧可执行程序中的 segment 实际上使用的方式是将多个 .o 中各个段合并到一起, 相同性质的段组合为一个大段, 如下所示</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230515145513.png" alt="20230515145513"></p><blockquote><p>正常来说 section 应该翻译为节, segment 翻译为段, 由于下文我们讨论单个目标文件的 ELF 格式, section 统称为段</p></blockquote><p>使用 <code>readelf -S</code> 可以查看 SimpleSection.o 中所有的段的偏移量和大小, 可以看到一共有 14 个段</p><pre class="language-shell"><code><span class="Token VARIANT">$</span><span class="Token SPACE"> </span><span class="Program Token ID">readelf</span><span class="Token SPACE"> </span><span class="Token OPTION">-S</span><span class="Token SPACE"> </span><span class="Token ID">SimpleSection.o</span><span class="Token LF">
</span><span class="Program Token ID">There</span><span class="Token SPACE"> </span><span class="Token ID">are</span><span class="Token SPACE"> </span><span class="Token NUMBER">14</span><span class="Token SPACE"> </span><span class="Token ID">section</span><span class="Token SPACE"> </span><span class="Token ID">headers</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">starting</span><span class="Token SPACE"> </span><span class="Token ID">at</span><span class="Token SPACE"> </span><span class="Token ID">offset</span><span class="Token SPACE"> </span><span class="Token NUMBER">0x410</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Program Token ID">Section</span><span class="Token SPACE"> </span><span class="Token ID">Headers:</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Program Token ID">Nr</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ID">Name</span><span class="Token SPACE">              </span><span class="Token ID">Type</span><span class="Token SPACE">             </span><span class="Token ID">Address</span><span class="Token SPACE">           </span><span class="Token ID">Offset</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Program Token ID">Size</span><span class="Token SPACE">              </span><span class="Token ID">EntSize</span><span class="Token SPACE">          </span><span class="Token ID">Flags</span><span class="Token SPACE">  </span><span class="Token ID">Link</span><span class="Token SPACE">  </span><span class="Token ID">Info</span><span class="Token SPACE">  </span><span class="Token ID">Align</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE">                   </span><span class="Program Token ID">NULL</span><span class="Token SPACE">             </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000000</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">           </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.text</span><span class="Token SPACE">             </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000040</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000064</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Program Token ID">AX</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">2</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.rela.text</span><span class="Token SPACE">        </span><span class="Token ID">RELA</span><span class="Token SPACE">             </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000002</span><span class="Token ID">f0</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000078</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000018</span><span class="Token SPACE">   </span><span class="Program Token ID">I</span><span class="Token SPACE">      </span><span class="Token NUMBER">11</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">3</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.data</span><span class="Token SPACE">             </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000</span><span class="Token ID">a4</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000008</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Program Token ID">WA</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">4</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.bss</span><span class="Token SPACE">              </span><span class="Token ID">NOBITS</span><span class="Token SPACE">           </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000</span><span class="Token ID">ac</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000008</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Program Token ID">WA</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">5</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.rodata</span><span class="Token SPACE">           </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000</span><span class="Token ID">ac</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000004</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">   </span><span class="Program Token ID">A</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">6</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.comment</span><span class="Token SPACE">          </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000</span><span class="Token ID">b0</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">000000000000002e</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000001</span><span class="Token SPACE">  </span><span class="Program Token ID">MS</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">7</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.note.GNU-stack</span><span class="Token SPACE">   </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000</span><span class="Token ID">de</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">           </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">8</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.note.gnu.pr</span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token ID">...</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ID">NOTE</span><span class="Token SPACE">             </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">000000e0</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000020</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">   </span><span class="Program Token ID">A</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token SPACE"> </span><span class="Token NUMBER">9</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.eh_frame</span><span class="Token SPACE">         </span><span class="Token ID">PROGBITS</span><span class="Token SPACE">         </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000100</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000058</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">   </span><span class="Program Token ID">A</span><span class="Token SPACE">       </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token NUMBER">10</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.rela.eh_frame</span><span class="Token SPACE">    </span><span class="Token ID">RELA</span><span class="Token SPACE">             </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000368</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000030</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000018</span><span class="Token SPACE">   </span><span class="Program Token ID">I</span><span class="Token SPACE">      </span><span class="Token NUMBER">11</span><span class="Token SPACE">     </span><span class="Token NUMBER">9</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token NUMBER">11</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.symtab</span><span class="Token SPACE">           </span><span class="Token ID">SYMTAB</span><span class="Token SPACE">           </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000158</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000138</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000018</span><span class="Token SPACE">          </span><span class="Token NUMBER">12</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token NUMBER">12</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.strtab</span><span class="Token SPACE">           </span><span class="Token ID">STRTAB</span><span class="Token SPACE">           </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000290</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000060</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">           </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="BraceDepth-0 Token LSQUAR_PAREN">[</span><span class="Token NUMBER">13</span><span class="BraceDepth-0 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Program Token ID">.shstrtab</span><span class="Token SPACE">         </span><span class="Token ID">STRTAB</span><span class="Token SPACE">           </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">  </span><span class="Token NUMBER">00000398</span><span class="Token LF">
</span><span class="Token SPACE">       </span><span class="Token NUMBER">0000000000000074</span><span class="Token SPACE">  </span><span class="Token NUMBER">0000000000000000</span><span class="Token SPACE">           </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">0</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Program Token ID">Key</span><span class="Token SPACE"> </span><span class="Token ID">to</span><span class="Token SPACE"> </span><span class="Token ID">Flags:</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Function Program Token ID">W</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">write</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">A</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">alloc</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">X</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">execute</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">M</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">merge</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">S</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">strings</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">I</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">info</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Function Program Token ID">L</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">link</span><span class="Token SPACE"> </span><span class="Token ID">order</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">O</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">extra</span><span class="Token SPACE"> </span><span class="Token ID">OS</span><span class="Token SPACE"> </span><span class="Token ID">processing</span><span class="Token SPACE"> </span><span class="Token ID">required</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">G</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">group</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">T</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">TLS</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Function Program Token ID">C</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">compressed</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">x</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">unknown</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">o</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">OS</span><span class="Token SPACE"> </span><span class="Token ID">specific</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">E</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">exclude</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">  </span><span class="Function Program Token ID">D</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">mbind</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">l</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">large</span><span class="BraceDepth-0 Token RPAREN">)</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Function Token ID">p</span><span class="Token SPACE"> </span><span class="BraceDepth-0 Token LPAREN">(</span><span class="Token ID">processor</span><span class="Token SPACE"> </span><span class="Token ID">specific</span><span class="BraceDepth-0 Token RPAREN">)</span></code></pre><p>其中 ELF Header 对应第 0 个无名段, 1-13 section 依次对应右侧的段. 由于段的大小(Size) 和起始地址 (Offset) 都不确定, 所以我们需要一个结构体数组来保存各个段的信息, 在 ELF 文件中这个数据结构叫做 <b>(Section Header Table)段表</b> , 下图左侧最后一个即为整个 ELF 文件的段表, 值得一提的是<b>段表并不算一个段, 它是独立于段之外的, 用于记录所有段信息的一个数组</b></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230820212800.png" alt="20230820212800"></p><p>根据输出信息可以画出整个 ELF 文件的排布, Offset 对应每一个段的起始位置, Size 对应段的大小, 0x000 - 0x40c 之间分别对应各个段, 0x40c - 0x410 对齐, 0x410 之后是段表, 段表一共0x380字节所以总字节数为 0x410 + 0x380 = 0x790 = 1936 字节, 也就是整个ELF文件的大小</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230820224134.png" alt="20230820224134"></p><p>那么如何找到段表的位置呢? 前面我们提到了 ELF Header 为整个 ELF 文件的文件头, 其中 ELF Header 的结构体如下所示, 相关结构体元素的含义以注释的形式说明. 我们可以使用 <code>readelf -h</code> 参数查看 ELF 文件头, 其中的 <code>e_shoff</code> 就记录了段表在整个 ELF 文件中的偏移地址, <code>e_shnum</code> 记录了段的个数</p><p><b>因此我们只需要从文件开头开始读取 sizeof(Elf64_Ehdr) 字节, 就可以利用这个地址找到段表的位置了</b></p><pre class="language-c"><code><span class="Keyword Token StorageType TYPEDEF">typedef</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Structure Keyword Token StructureType STRUCT">struct</span><span class="TypeSpecifier Structure Keyword Token StructureType SPACE"> </span><span class="Structure BraceDepth-0 Token LCURLY_BRACE">{</span><span class="Structure Token LF">
</span><span class="Structure Token SPACE">    </span><span class="TypeSpecifier Keyword Token BaseType UNSIGNED">unsigned</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType CHAR">char</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_ident</span><span class="BraceDepth-1 Token DirectDeclaractorPostfix LSQUAR_PAREN">[</span><span class="TypeSpecifier Identifier Token MacroDefine PrimaryExpression ID">EI_NIDENT</span><span class="BraceDepth-1 Token DirectDeclaractorPostfix RSQUAR_PAREN">]</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE"> </span><span class="StructDeclaration Token COMMENT">// 一些信息</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_type</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">             </span><span class="StructDeclaration Token COMMENT">// 文件类型</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_machine</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">          </span><span class="StructDeclaration Token COMMENT">// CPU类型</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_version</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">          </span><span class="StructDeclaration Token COMMENT">// ELF版本号</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">ElfN_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">     </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_entry</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 入口地址</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">ElfN_Off</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_phoff</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 程序头入口</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">ElfN_Off</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_shoff</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 段表在文件中的偏移</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_flags</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 标志位</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_ehsize</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">           </span><span class="StructDeclaration Token COMMENT">// ELF文件头大小</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_phentsize</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">        </span><span class="StructDeclaration Token COMMENT">// 程序头大小</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_phnum</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 程序头个数</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_shentsize</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">        </span><span class="StructDeclaration Token COMMENT">// 段表描述符大小, 等同于 sizeof(ElfN_Ehdr)</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_shnum</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">            </span><span class="StructDeclaration Token COMMENT">// 段表描述符数量</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint16_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">      </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">e_shstrndx</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">// 段表字符串表的在段表中的索引值</span><span class="StructDeclaration Token LF">
</span><span class="Structure BraceDepth-0 Token RCURLY_BRACE">}</span><span class="Structure Token SPACE"> </span><span class="Typedefine Identifier DirectDeclaractor Token ID">ElfN_Ehdr</span><span class="Declaration Token SEMI">;</span></code></pre><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230820224330.png" alt="20230820224330"></p><blockquote><p>其中e_entry入口地址指 ELF 程序的虚拟入口地址, 操作系统在加载完该程序后从这个而地址开始执行进程的指令, 可重定位文件一般没有入口地址, 对于可执行文件来说有 program_header 和 entry 的概念</p></blockquote><p>关于 ELF 的所有定义都在 <code>/usr/include/elf.h</code> 中, ELF 兼顾了32/64位机器, 所以在实际编写程序时需要根据目标机器将 N 替换为 32 或 64, 对于 32/64 位机器也有不同的 size 大小, 这里我们只考虑 64 位机的情况</p><table><tr><th>typedef</th><th>type</th><th>32-bit size (bytes)</th><th>64-bit size (bytes)</th></tr><tr><td style="text-align:center">                ElfN_Addr</td><td style="text-align:center">                Unsigned program address, uintN_t</td><td style="text-align:center">                4</td><td style="text-align:center">                8</td></tr><tr><td style="text-align:center">                ElfN_Off</td><td style="text-align:center">                Unsigned file offset, uintN_t</td><td style="text-align:center">                4</td><td style="text-align:center">                8</td></tr><tr><td style="text-align:center">                ElfN_Section</td><td style="text-align:center">                Unsigned section index, uint16_t</td><td style="text-align:center">                2</td><td style="text-align:center">                2</td></tr><tr><td style="text-align:center">                ElfN_Versym</td><td style="text-align:center">                Unsigned version symbol information, uint16_t</td><td style="text-align:center">                2</td><td style="text-align:center">                2</td></tr><tr><td style="text-align:center">                Elf_Byte</td><td style="text-align:center">                unsigned char</td><td style="text-align:center">                1</td><td style="text-align:center">                1</td></tr><tr><td style="text-align:center">                ElfN_Half</td><td style="text-align:center">                uint16_t</td><td style="text-align:center">                2</td><td style="text-align:center">                2</td></tr><tr><td style="text-align:center">                ElfN_Sword</td><td style="text-align:center">                int32_t</td><td style="text-align:center">                4</td><td style="text-align:center">                4</td></tr><tr><td style="text-align:center">                ElfN_Word</td><td style="text-align:center">                uint32_t</td><td style="text-align:center">                4</td><td style="text-align:center">                4</td></tr><tr><td style="text-align:center">                ElfN_Sxword</td><td style="text-align:center">                int64_t</td><td style="text-align:center">                8</td><td style="text-align:center">                8</td></tr><tr><td style="text-align:center">                ElfN_Xword</td><td style="text-align:center">                uint64_t</td><td style="text-align:center">                8</td><td style="text-align:center">                8</td></tr></table><blockquote><p>读者可以使用 <code>man elf</code> 来查看相关信息</p></blockquote><p>可以看到最前面的四个字节 <code>7f 45 4c 46</code> 是所有 ELF 文件都必须相同的标识码, 第一个字节对应 ASCII 的 DEL 控制符, 后面三个字节对应 ELF 三个字符的ASCII码, 这四个字节被称为 ELF 文件的<b>魔数</b>, 几乎所有可执行文件的开始的几个字节都是魔数</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230506004437.png" alt="20230506004437"></p><p>比如 a.out 开始的为 0x01 0x07, PE/COFF 为 0x4d 0x5a(MZ). 魔数用来确定文件的类型, 操作系统在加载可执行文件的时候会确认魔数是否正确, 如果不正确会拒绝加载</p><blockquote><p>见 <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/binfmt_elf.c#n1368" target="_blank">fs/binfmt_elf.c:load_elf_library</a>, 在加载时判断了 if (memcmp(elf_ex.e_ident, ELFMAG, SELFMAG) != 0) goto out;</p></blockquote><h3 id="h3-4">段表</h3><p>通过 ELF Header 找到了段表, 段表实际上是一个数组, 数组中每一个元素都是 <code>Elf64_Shdr</code> 结构体, 用于储存每一个段的信息, 可以计算得到该结构体占据 (4x4+8x6) = 64 个字节, 其定义如下所示</p><pre class="language-c"><code><span class="Keyword Token StorageType TYPEDEF">typedef</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Structure Keyword Token StructureType STRUCT">struct</span><span class="TypeSpecifier Structure Keyword Token StructureType SPACE"> </span><span class="Structure BraceDepth-0 Token LCURLY_BRACE">{</span><span class="Structure Token LF">
</span><span class="Structure Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_name</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段名</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_type</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段类型</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint64_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_flags</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">     </span><span class="StructDeclaration Token COMMENT">// 段标志位</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_addr</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段虚拟地址</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Off</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">  </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_offset</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">    </span><span class="StructDeclaration Token COMMENT">// 段偏移</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint64_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_size</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段长度</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_link</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段链接信息</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint32_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_info</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">// 段链接信息</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint64_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_addralign</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE"> </span><span class="StructDeclaration Token COMMENT">// 段地址对齐</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">uint64_t</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">sh_entsize</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">   </span><span class="StructDeclaration Token COMMENT">// 段条目的长度</span><span class="StructDeclaration Token LF">
</span><span class="Structure BraceDepth-0 Token RCURLY_BRACE">}</span><span class="Structure Token SPACE"> </span><span class="Typedefine Identifier DirectDeclaractor Token ID">Elf64_Shdr</span><span class="Declaration Token SEMI">;</span></code></pre><p>当然这里也可以使用 <code>readelf -h</code> 列出 ELF Header 查看到一共有段表中有14项,每一项对应每一个段都是64字节, 总大小为 64x14= 896B = 0x380</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230506010254.png" alt="20230506010254"></p><p>因此找到每一个段的流程如下, <b>ELF 文件中的每一个段的设计都是结构体数组</b>, 段表中为 <code>Elf64_Shdr</code> 数组, 重定位表为 <code>Elf64_Rela</code> 数组, 符号表为 <code>Elf64_Sym</code> 数组, 程序头为 <code>Elf64_Phdr</code> 数组:</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230824083626.png" alt="20230824083626"></p><p>值得注意的是上文中 Elf64_Shdr 结构体的字段 <code>sh_name</code> 的含义是段名, 但是类型是 uint32_t 而非 char*, 这是因为段本身并不记录其名字, 段的名字在 <code>.shstrtab</code> (段表字符串表)中统一记录, <code>sh_name</code> 是一个索引值. 采用这种方式就可以固定下来 <code>Elf64_Shdr</code> 结构体的大小, 因为 ELF 文件中用到了很多字符串, 比如段名,变量名等等, 字符串的长度往往是不确定的, 所以用固定的结构来表示它比较困难. 一种常见的做法就是把字符串集中起来存在一个表中, 这一点和ext文件系统的inode对于文件名的管理方式有些类似</p><blockquote><p>0x410 之后是段表, 0x398 开始是 .shstrtab(段表字符串表), 记录了每一个段的名字</p></blockquote><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230506004340.png" alt="20230506004340"></p><p>因此找到每一个段名字的方法如下, 首先找到 shstrtab, 然后利用每一个段 shdr 中的 sh_name 作为偏移量计算地址</p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230824090541.png" alt="20230824090541"></p><h3 id="h3-5">符号表和重定位表</h3><p>符号表(.symtab) 和 重定位表(.rela) 对于 ELF 文件来说是很重要的, 涉及到之后链接器 ld. 符号表的 sh_type 为 <code>SHT_SYMTAB</code> 或 <code>SHT_DYNSYM</code>, 重定位表的 sh_type 是 <code>SHT_RELA</code>, 遍历所有段判断 sh_type 类型即可</p><p>如果段的类型是与链接相关的, 比如重定位表(.rela)和符号表(.symtab), 那么 <code>sh_link</code> 和 <code>sh_info</code> 这两个段就有含义, 否则是无意义的.</p><p>对于重定位表 RELA, <code>sh_link</code> 代表该段所对应的符号表(.symbol)的下标, <code>sh_info</code> 表示它作用的重定位的段. 如下所示</p><blockquote><p>见 src/readelf.c 中的 <code>display_elf_relocation_table</code></p></blockquote><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230821095550.png" alt="20230821095550"></p><p>重定位表中的每一个表项都是一个 Elf64_Rela 结构体, 成员含义如下所示</p><pre class="language-c"><code><span class="Keyword Token StorageType TYPEDEF">typedef</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Structure Keyword Token StructureType STRUCT">struct</span><span class="Structure BraceDepth-0 Token LCURLY_BRACE">{</span><span class="Structure Token LF">
</span><span class="Structure Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">r_offset</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">     </span><span class="StructDeclaration Token COMMENT">/* 地址 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Xword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">r_info</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">/* 重定位类型和符号索引 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Sxword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">r_addend</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">   </span><span class="StructDeclaration Token COMMENT">/* 偏移量 */</span><span class="StructDeclaration Token LF">
</span><span class="Structure BraceDepth-0 Token RCURLY_BRACE">}</span><span class="Structure Token SPACE"> </span><span class="Typedefine Identifier DirectDeclaractor Token ID">Elf64_Rela</span><span class="Declaration Token SEMI">;</span></code></pre><p>对于符号表 SYMTAB, <code>sh_link</code> 指向该段对应的字符串表(通常是 .strtab), st_info 的低4位用于符号类型, 高4位用于符号绑定信息</p><blockquote><p>见 src/readelf.c 中的 <code>display_elf_symbol_table</code></p></blockquote><p>符号表的每一个表项都是一个 Elf64_Sym 结构体, 成员含义如下所示</p><pre class="language-c"><code><span class="Keyword Token StorageType TYPEDEF">typedef</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Structure Keyword Token StructureType STRUCT">struct</span><span class="TypeSpecifier Structure Keyword Token StructureType SPACE"> </span><span class="Structure BraceDepth-0 Token LCURLY_BRACE">{</span><span class="Structure Token LF">
</span><span class="Structure Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Word</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_name</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">      </span><span class="StructDeclaration Token COMMENT">/* 符号名称(字符串表索引) */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="TypeSpecifier Keyword Token BaseType UNSIGNED">unsigned</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType CHAR">char</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_info</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">   </span><span class="StructDeclaration Token COMMENT">/* 符号类型和绑定 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="TypeSpecifier Keyword Token BaseType UNSIGNED">unsigned</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Keyword Token BaseType CHAR">char</span><span class="TypeSpecifier Keyword Token BaseType SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_other</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">  </span><span class="StructDeclaration Token COMMENT">/* 符号可见性 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Section</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_shndx</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">  </span><span class="StructDeclaration Token COMMENT">/* 节索引 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_value</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">     </span><span class="StructDeclaration Token COMMENT">/* 符号值 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Xword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE"> </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">st_size</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">     </span><span class="StructDeclaration Token COMMENT">/* 符号大小 */</span><span class="StructDeclaration Token LF">
</span><span class="Structure BraceDepth-0 Token RCURLY_BRACE">}</span><span class="Structure Token SPACE"> </span><span class="Typedefine Identifier DirectDeclaractor Token ID">Elf64_Sym</span><span class="Declaration Token SEMI">;</span></code></pre><h3 id="h3-6">程序头(program header)</h3><p>program header 在可重定位文件中不存在, 仅存在于已经完成链接的可执行文件, 可以使用 <code>-l</code> 选项查看</p><pre class="language-c"><code><span class="Keyword Token StorageType TYPEDEF">typedef</span><span class="Keyword Token StorageType SPACE"> </span><span class="TypeSpecifier Structure Keyword Token StructureType STRUCT">struct</span><span class="TypeSpecifier Structure Keyword Token StructureType SPACE"> </span><span class="Structure BraceDepth-0 Token LCURLY_BRACE">{</span><span class="Structure Token LF">
</span><span class="Structure Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Word</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">    </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_type</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">          </span><span class="StructDeclaration Token COMMENT">/* 段类型 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Word</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">    </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_flags</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">/* 段标志 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Off</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">     </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_offset</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">        </span><span class="StructDeclaration Token COMMENT">/* 段在文件中的偏移量 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">    </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_vaddr</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">/* 段的虚拟地址 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Addr</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">    </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_paddr</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">/* 段的物理地址 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Xword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_filesz</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">        </span><span class="StructDeclaration Token COMMENT">/* 段在文件中的大小 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Xword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_memsz</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">/* 段在内存中的大小 */</span><span class="StructDeclaration Token LF">
</span><span class="StructDeclaration Token SPACE">    </span><span class="Typedefine TypeSpecifier Keyword Token TYPEDEF_ID">Elf64_Xword</span><span class="Typedefine TypeSpecifier Keyword Token SPACE">   </span><span class="TypeSpecifier Identifier DirectDeclaractor Token ID">p_align</span><span class="StructDeclaration Token SEMI">;</span><span class="StructDeclaration Token SPACE">         </span><span class="StructDeclaration Token COMMENT">/* 段对齐方式 */</span><span class="StructDeclaration Token LF">
</span><span class="Structure BraceDepth-0 Token RCURLY_BRACE">}</span><span class="Structure Token SPACE"> </span><span class="Typedefine Identifier DirectDeclaractor Token ID">Elf64_Phdr</span><span class="Declaration Token SEMI">;</span></code></pre><h2 id="h2-7">参考</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/380908650" target="_blank">ELF 文件解析 1-前述+文件头分析</a></li></ul></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../md-docs/readelf" >readelf</a></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../md-docs/README",".","ab")</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>